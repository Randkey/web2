{% extends "base.html" %}
{% block content %}
<div class="card">
  <h2>Список книг</h2>
  <p class="muted">Отсортировано по году (сначала новые). На странице не более 10 книг.</p>

  <table>
    <thead>
      <tr>
        <th>Обложка</th>
        <th>Название / Жанры</th>
        <th>Год</th>
        <th>Средний рейтинг</th>
        <th>Рецензии</th>
        <th>Действия</th>
      </tr>
    </thead>
    <tbody>
      {% for b in books %}
        <tr>
          <td>
            {% if b['cover'] %}
              <img class="cover-thumb" src="{{ url_for('static', filename=b['cover']) }}" alt="cover">
            {% else %}
              <div style="width:72px;height:100px;background:#eee;border-radius:6px;display:flex;align-items:center;justify-content:center;color:#aaa;">Нет</div>
            {% endif %}
          </td>
          <td>
            <strong>{{ b['title'] }}</strong><br/>
            <span class="muted">{{ b['genres'] or '—' }}</span>
          </td>
          <td>{{ b['year'] }}</td>
          <td>{{ "%.2f"|format(b['avg_rating'] or 0) }}</td>
          <td>{{ b['review_count'] or 0 }}</td>
          <td>
          <div class="actions">
            <a class="btn btn-small" href="{{ url_for('books.book_view', book_id=b['id']) }}">Просмотр</a>

            {% if g.user_role in ['админ','модератор'] %}
              <a class="btn btn-small" href="{{ url_for('books.book_edit', book_id=b['id']) }}" title="Редактировать">Редактировать</a>
            {% endif %}

            {% if g.user_role == 'админ' %}
              <form method="post" action="{{ url_for('books.book_delete', book_id=b['id']) }}" class="delete-form" style="display:inline;">
                <input type="hidden" name="book_title" value="{{ b['title'] }}">
                <button type="submit" class="btn btn-small" style="background:#e74c3c;">Удалить</button>
              </form>
            {% endif %}
          </div>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="pagination">
    {% if page > 1 %}
      <a class="btn btn-small" href="{{ url_for('books.index', page=page-1) }}">← Назад</a>
    {% endif %}
    <span class="muted">Страница {{ page }} из {{ total_pages }}</span>
    {% if page < total_pages %}
      <a class="btn btn-small" href="{{ url_for('books.index', page=page+1) }}">Вперед →</a>
    {% endif %}
  </div>

  {% if g.user_role == 'админ' %}
    <div style="margin-top:12px;">
      <a class="btn" href="{{ url_for('books.book_add') }}" title="Добавление книги">Добавить книгу</a>
    </div>
  {% endif %}
</div>
{% endblock %}
